<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>API Omeka S - Artistes</title>
</head>
<body>
  <h1>Lecture et Ã©criture via lâ€™API Omeka S (modÃ¨le Artiste)</h1>

  <h2>ğŸ” Lire les artistes</h2>
  <button id="btnGet">Afficher les artistes</button>
  <pre id="resultat"></pre>

  <h2>ğŸ“ Ajouter un artiste</h2>
  <form id="formAjout">
    <label>Nom de lâ€™artiste :</label>
    <input type="text" id="nomArtiste" required>
    <button type="submit">Ajouter</button>
  </form>

  <pre id="resultatAjout"></pre>

  <script>
    // âš™ï¸ Configuration API 
const baseURL = "http://localhost/omk_THyp_25-26_clone/omeka-s/api/items";
const key_identity = "v93tumeJwroU6cKf7hkIDjgVr5FFZHBn"; 
const key_credential = "1xPr6ZPSgnawyRLJwPKB5m6MejBU4xEg";

    // ğŸ”¹ Lecture des artistes
    document.getElementById("btnGet").addEventListener("click", () => {
      const url = `${baseURL}?key_identity=${key_identity}&key_credential=${key_credential}`;
      fetch(url)
        .then(response => {
          if (!response.ok) throw new Error(`Erreur HTTP ${response.status}`);
          return response.json();
        })
        .then(data => {
          let txt = "";
          data.forEach(item => {
            const nom = item["o:title"] || "(sans titre)";
            txt += `ğŸµ ${nom}\n`;
          });
          document.getElementById("resultat").textContent = txt;
        })
        .catch(err => {
          document.getElementById("resultat").textContent =
            "âŒ Erreur de lecture : " + err.message;
        });
    });

    // ğŸ”¹ Ajout dâ€™un artiste
    document.getElementById("formAjout").addEventListener("submit", e => {
      e.preventDefault();
      const nom = document.getElementById("nomArtiste").value;

      // Objet JSON conforme Ã  "Artiste"
      const newArtiste = {
        "o:resource_template": { "o:id": 7 },  // modÃ¨le Pandore/Artiste
        "o:resource_class": { "o:id": 108 },   // classe Artiste
        "o:title": nom,
        "pandore:nomArtiste": [
          { "@value": nom, "@language": "fr" }
        ]
      };

      fetch(`${baseURL}?key_identity=${key_identity}&key_credential=${key_credential}`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(newArtiste)
      })
        .then(response => {
          if (!response.ok) throw new Error(`Erreur HTTP ${response.status}`);
          return response.json();
        })
        .then(data => {
          document.getElementById("resultatAjout").textContent =
            "âœ… Artiste ajoutÃ© avec succÃ¨s :\n" + JSON.stringify(data, null, 2);
        })
        .catch(err => {
          document.getElementById("resultatAjout").textContent =
            "âŒ Erreur : " + err.message;
        });
    });
  </script>
</body>
</html>
